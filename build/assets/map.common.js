//# sourceMappingURL=map.common.js.map
var areaCounter=0;function addClickEventForVector(a){var b="drawnArea"+areaCounter;areaCounter++;MAP_VAR.map.addHandler(b,L.AreaPopupHandler.extend({layer:a}));MAP_VAR.map[b].enable()}function removeLayer(a){void 0!==MAP_VAR.map._layers[a]&&MAP_VAR.map.removeLayer(MAP_VAR.map._layers[a])}
L.AreaPopupHandler=L.Handler.extend({layer:null,addHooks:function(){L.DomEvent.on(this.layer,"click",this._generatePopup,this)},removeHooks:function(){L.DomEvent.off(this.layer,"click",this._generatePopup,this)},_generatePopup:function(a){generatePopup(this.layer,a.latlng)}});L.PointClickHandler=L.Handler.extend({obj:null,addHooks:function(){L.DomEvent.on(this.obj,"click",pointLookupClickRegister,this)},removeHooks:function(){L.DomEvent.off(this.obj,"click",pointLookupClickRegister,this)}});
function generatePopup(a,b){var c;jQuery.isFunction(a.getRadius)?c=getParamsForCircle(a):(c=new Wkt.Wkt,c.fromObject(a),c=getParamsforWKT(c.write()));null==b&&(b=a.getBounds().getCenter());L.popup().setLatLng([b.lat,b.lng]).setContent("species count: <b id='speciesCountDiv'>calculating...</b><br>occurrence count: <b id='occurrenceCountDiv'>calculating...</b><br><a id='showOnlyTheseRecords' href='"+BC_CONF.contextPath+"/occurrences/search"+c+"'>"+jQuery.i18n.prop("search.map.popup.linkText")+"</a><br><a id='removeArea' href='javascript:void(0)' onclick='removeLayer(\""+
a._leaflet_id+"\");MAP_VAR.map.closePopup()'>"+jQuery.i18n.prop("search.map.popup.removeText")+"</a>").openOn(MAP_VAR.map);getSpeciesCountInArea(c);getOccurrenceCountInArea(c)}function getSpeciesCountInArea(a){speciesCount=-1;$.getJSON(BC_CONF.biocacheServiceUrl+"/occurrence/facets.json"+a+"&facets=taxon_name&callback=?",function(a){a&&0<a.length&&void 0!==a[0].count?(a=a[0].count,document.getElementById("speciesCountDiv").innerHTML=a):document.getElementById("speciesCountDiv").innerHTML=0})}
function getOccurrenceCountInArea(a){occurrenceCount=-1;$.getJSON(BC_CONF.biocacheServiceUrl+"/occurrences/search.json"+a+"&pageSize=0&facet=off&callback=?",function(a){a&&void 0!==a.totalRecords?(a=a.totalRecords,document.getElementById("occurrenceCountDiv").innerHTML=a,"0"==a&&$("#showOnlyTheseRecords").hide()):document.getElementById("occurrenceCountDiv").innerHTML=0})}function getParamsforWKT(a){return"?"+getExistingParams()+"&wkt="+encodeURI(a.replace(" ","+"))}
function getParamsForCircle(a){var b=a.getLatLng();a=Math.round(a.getRadius()/1E3*10)/10;return"?"+getExistingParams()+"&radius="+a+"&lat="+b.lat+"&lon="+b.lng}function getExistingParams(){var a=$.url(MAP_VAR.query).param();a.q||(a.q="*:*");delete a.wkt;delete a.lat;delete a.lon;delete a.radius;var b=document.createElement("textarea");b.innerHTML=decodeURI(BC_CONF.queryContext);a.qc=b.value;return $.param(a)}
function drawWktObj(a){var b=new Wkt.Wkt;b.read(a);a=b.toObject({color:"#bada55"});generatePopup(a.getLayers()[0],null);addClickEventForVector(a);MAP_VAR.drawnItems.addLayer(a);void 0!==a.getBounds&&"function"===typeof a.getBounds?MAP_VAR.map.fitBounds(a.getBounds()):focus&&void 0!==a.getLatLng&&"function"===typeof a.getLatLng&&MAP_VAR.map.panTo(a.getLatLng())};