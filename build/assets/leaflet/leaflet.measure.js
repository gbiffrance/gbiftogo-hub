//# sourceMappingURL=leaflet.measure.js.map
L.Control.Measure=L.Control.extend({options:{position:"topleft"},onAdd:function(a){a=L.DomUtil.create("div","leaflet-control-zoom leaflet-bar leaflet-control");this._createButton("","Measure","leaflet-control-measure leaflet-bar-part leaflet-bar-part-top fa fa-arrows-h",a,this._toggleMeasure,this);this.hideCalibration||this._createButton("","Calibrate","viewer-custom-buttons leaflet-disabled leaflet-control-measure leaflet-bar-part leaflet-bar-bottom fa fa-sliders btnCalibrateMMPerPixels",a,this._calibrate,
this);return a},_calibrate:function(a){this.mmPerPixel=this.onCalibration(this._pixelDistance);this._toggleMeasure()},_disableCalibration:function(){$(".btnCalibrateMMPerPixels").addClass("leaflet-disabled")},_enableCalibration:function(){$(".btnCalibrateMMPerPixels").removeClass("leaflet-disabled")},_createButton:function(a,c,b,d,e,f){b=L.DomUtil.create("a",b,d);b.innerHTML=a;b.href="#";b.title=c;L.DomEvent.on(b,"click",L.DomEvent.stopPropagation).on(b,"click",L.DomEvent.preventDefault).on(b,"click",
e,f).on(b,"dblclick",L.DomEvent.stopPropagation);return b},_toggleMeasure:function(){(this._measuring=!this._measuring)?(L.DomUtil.addClass(this._container,"leaflet-control-measure-on"),this._startMeasuring()):(L.DomUtil.removeClass(this._container,"leaflet-control-measure-on"),this._stopMeasuring())},_startMeasuring:function(){this._oldCursor=this._map._container.style.cursor;this._map._container.style.cursor="crosshair";this._doubleClickZoom=this._map.doubleClickZoom.enabled();this._map.doubleClickZoom.disable();
L.DomEvent.on(this._map,"mousemove",this._mouseMove,this).on(this._map,"click",this._mouseClick,this).on(this._map,"dblclick",this._finishPath,this).on(document,"keydown",this._onKeyDown,this);this._layerPaint||(this._layerPaint=L.layerGroup().addTo(this._map))},_stopMeasuring:function(){this._map._container.style.cursor=this._oldCursor;L.DomEvent.off(document,"keydown",this._onKeyDown,this).off(this._map,"mousemove",this._mouseMove,this).off(this._map,"click",this._mouseClick,this).off(this._map,
"dblclick",this._mouseClick,this);this._doubleClickZoom&&this._map.doubleClickZoom.enable();this._layerPaint&&this._layerPaint.clearLayers();this._restartPath();this._disableCalibration()},_mouseMove:function(a){a.latlng&&this._lastPoint&&(this._layerPaintPathTemp?this._layerPaintPathTemp.spliceLatLngs(0,2,this._lastPoint,a.latlng):this._layerPaintPathTemp=L.polyline([this._lastPoint,a.latlng],{color:"black",weight:1.5,clickable:!1,dashArray:"6,3"}).addTo(this._layerPaint),this._tooltip&&(this._distance||
(this._distance=0),this._updateTooltipPosition(a.latlng),a=this._getPixelPoint(a.latlng),a=this._lastPixelPoint.pixelDistanceTo(a),this._updateTooltipDistance(this._pixelDistance+a,a)))},_mouseClick:function(a){if(a.latlng){if(this._lastPoint&&this._tooltip){this._distance||(this._distance=0);this._pixelDistance||(this._pixelDistance=0);this._updateTooltipPosition(a.latlng);var c=this._getPixelPoint(a.latlng).pixelDistanceTo(this._lastPixelPoint);this._pixelDistance+=c;var b=a.latlng.distanceTo(this._lastPoint);
this._updateTooltipDistance(this._pixelDistance,c);this._distance+=b;this._enableCalibration()}this._createTooltip(a.latlng);this._lastPoint&&!this._layerPaintPath&&(this._layerPaintPath=L.polyline([this._lastPoint],{color:"black",weight:2,clickable:!1}).addTo(this._layerPaint));this._layerPaintPath&&this._layerPaintPath.addLatLng(a.latlng);this._lastCircle&&this._layerPaint.removeLayer(this._lastCircle);this._lastCircle=(new L.CircleMarker(a.latlng,{color:"black",opacity:1,weight:1,fill:!0,fillOpacity:1,
radius:2,clickable:this._lastCircle?!0:!1})).addTo(this._layerPaint);this._lastCircle.on("click",function(){this._finishPath()},this);this._lastPoint=a.latlng;this._lastPixelPoint=this._getPixelPoint(a.latlng)}},_finishPath:function(){this._lastCircle&&this._layerPaint.removeLayer(this._lastCircle);this._tooltip&&this._layerPaint.removeLayer(this._tooltip);this._layerPaint&&this._layerPaintPathTemp&&this._layerPaint.removeLayer(this._layerPaintPathTemp);this._restartPath()},_restartPath:function(){this._distance=
0;this._layerPaintPathTemp=this._layerPaintPath=this._lastPoint=this._lastCircle=this._tooltip=void 0;this._pixelDistance=0;this._lastPixelPoint=void 0},_createTooltip:function(a){var c=L.divIcon({className:"leaflet-measure-tooltip",iconAnchor:[-5,-5]});this._tooltip=L.marker(a,{icon:c,clickable:!1}).addTo(this._layerPaint)},_updateTooltipPosition:function(a){this._tooltip.setLatLng(a)},_updateTooltipDistance:function(a,c){a||(a=c);var b=" pixels";this.mmPerPixel&&0!=this.mmPerPixel&&(b=" mm",a*=
this.mmPerPixel,c*=this.mmPerPixel);var d='<div class="leaflet-measure-tooltip-total">'+a.toFixed(2)+b+"</div>";0<c&&a!=c&&(d+='<div class="leaflet-measure-tooltip-difference">(+'+c.toFixed(2)+b+")</div>");this._tooltip._icon.innerHTML=d},_onKeyDown:function(a){27==a.keyCode&&(this._lastPoint?this._finishPath():this._toggleMeasure())},_getPixelPoint:function(a){return{x:Math.round(a.lng*this.imageScaleFactor),y:this.imageHeight-Math.round(a.lat*this.imageScaleFactor),pixelDistanceTo:function(a){return a?
Math.sqrt(Math.pow(a.x-this.x,2)+Math.pow(a.y-this.y,2)):0}}},mmPerPixel:0,imageScaleFactor:0,imageHeight:0,imageWidth:0,hideCalibration:!1,onCalibration:function(a){return 0}});L.Map.mergeOptions({measureControl:!1});
L.Map.addInitHook(function(){if(this.options.measureControl){this.measureControl=new L.Control.Measure;if("object"===typeof this.options.measureControl){var a=this.options.measureControl;a.mmPerPixel&&(this.measureControl.mmPerPixel=a.mmPerPixel);a.imageScaleFactor&&(this.measureControl.imageScaleFactor=a.imageScaleFactor);a.imageHeight&&(this.measureControl.imageHeight=a.imageHeight);a.imageWidth&&(this.measureControl.imageWidth=a.imageWidth);a.onCalibration&&(this.measureControl.onCalibration=a.onCalibration);
a.hideCalibration&&(this.measureControl.hideCalibration=a.hideCalibration)}this.addControl(this.measureControl)}});L.control.measure=function(a){return new L.Control.Measure(a)};