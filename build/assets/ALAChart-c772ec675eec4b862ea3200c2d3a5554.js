//# sourceMappingURL=ALAChart.js.map
var ALA={ChartConstants:{highlightColor:"#FF0000",colors:"#000000 #FFFF00 #1CE6FF #FF34FF #FF4A46 #008941 #006FA6 #A30059 #FFDBE5 #7A4900 #0000A6 #63FFAC #B79762 #004D43 #8FB0FF #997D87 #5A0007 #809693 #FEFFE6 #1B4400 #4FC601 #3B5DFF #4A3B53 #FF2F80 #61615A #BA0900 #6B7900 #00C2A0 #FFAA92 #FF90C9 #B903AA #D16100 #DDEFFF #000035 #7B4F4B #A1C299 #300018 #0AA6D8 #013349 #00846F #372101 #FFB500 #C2FFED #A079BF #CC0744 #C0B9B2 #C2FF99 #001E09 #00489C #6F0062 #0CBD66 #EEC3FF #456D75 #B77B68 #7A87A1 #788D66 #885578 #FAD09F #FF8A9A #D157A0 #BEC459 #456648 #0086ED #886F4C #34362D #B4A8BD #00A6AA #452C2C #636375 #A3C8C9 #FF913F #938A81 #575329 #00FECF #B05B6F #8CD0FF #3B9700 #04F757 #C8A1A1 #1E6E00 #7900D7 #A77500 #6367A9 #A05837 #6B002C #772600 #D790FF #9B9700 #549E79 #FFF69F #201625 #72418F #BC23FF #99ADC0 #3A2465 #922329 #5B4534 #FDE8DC #404E55 #0089A3 #CB7E98 #A4E804 #324E72 #6A3A4C #83AB58 #001C1E #D1F7CE #004B28 #C8D0F6 #A3A489 #806C66 #222800 #BF5650 #E83000 #66796D #DA007C #FF1A59 #8ADBB4 #1E0200 #5B4E51 #C895C5 #320033 #FF6832 #66E1D3 #CFCDAC #D0AC94 #7ED379 #012C58 #7A7BFF #D68E01 #353339 #78AFA1 #FEB2C6 #75797C #837393 #943A4D #B5F4FF #D2DCD5 #9556BD #6A714A #001325 #02525F #0AA3F7 #E98176 #DBD5DD #5EBCD1 #3D4F44 #7E6405 #02684E #962B75 #8D8546 #9695C5 #E773CE #D86A78 #3E89BE #CA834E #518A87 #5B113C #55813B #E704C4 #00005F #A97399 #4B8160 #59738A #FF5DA7 #F7C9BF #643127 #513A01 #6B94AA #51A058 #A45B02 #1D1702 #E20027 #E7AB63 #4C6001 #9C6966 #64547B #97979E #006A66 #391406 #F4D749 #0045D2 #006C31 #DDB6D0 #7C6571 #9FB2A4 #00D891 #15A08A #BC65E9 #FFFFFE #C6DC99 #203B3C #671190 #6B3A64 #F5E1FF #FFA0F2 #CCAA35 #374527 #8BB400 #797868 #C6005A #3B000A #C86240 #29607C #402334 #7D5A44 #CCB87C #B88183 #AA5199 #B5D6C3 #A38469 #9F94F0 #A74571 #B894A6 #71BB8C #00B433 #789EC9 #6D80BA #953F00 #5EFF03 #E4FFFC #1BE177 #BCB1E5 #76912F #003109 #0060CD #D20096 #895563 #29201D #5B3213 #A76F42 #89412E #1A3A2A #494B5A #A88C85 #F4ABAA #A3F3AB #00C6C8 #EA8B66 #958A9F #BDC9D2 #9FA064 #BE4700 #658188 #83A485 #453C23 #47675D #3A3F00 #061203 #DFFB71 #868E7E #98D058 #6C8F7D #D7BFC2 #3C3E6E #D83D66 #2F5D9B #6C5E46 #D25B88 #5B656C #00B57F #545C46 #866097 #365D25 #252F99 #00CCFF #674E60 #FC009C #92896B".split(" "),
legendTemplate:'<ul style="list-style-type:none;" class="ala-<%=name.toLowerCase()%>-legend"><% for (var i=0; i<segments.length; i++){%><li><span style="background-color:<%=segments[i].fillColor%>"></span><%if(segments[i].label){%><%=segments[i].label%><%}%></li><%}%></ul>'},BiocacheCharts:function(w,e){function r(a,c){if(a instanceof Array){var b=[];$.each(a,function(a,h){b.push(x(h,c))});return b}return x(a,c)}function x(a,c){return"rgba("+parseInt(a.slice(1,3),16)+","+parseInt(a.slice(3,5),16)+
","+parseInt(a.slice(5,7),16)+","+c/100+")"}function N(a){if(confirm("Are you sure you want to delete this chart?")){var c=$(a.target).closest(".chart").attr("id"),b;for(b in e.charts)e.charts[b].divId==c&&delete e.charts[b];e.chartControlsCallback&&e.chartControlsCallback(e);$(a.target).parent().detach()}}function O(a){$(a.target).is(":checked")?y(a):z(a)}function z(a){a=$(a.target).closest(".chart");a.children(".chart-canvas").hide();a.children(".chart-legend").hide();a.children(".chart-no-data-label").hide();
a.find("#controlsMapTab").hide()}function y(a){a=$(a.target).closest(".chart");if(0==a.children(".chart-canvas").size()&&0==a.children(".chart-canvas").size()){a=a.attr("id");for(var c in e.charts)e.charts[c].divId==a&&p(e.charts[c].facet,e.charts[c])}else for(c in a.children(".chart-canvas").show(),a.children(".chart-legend").show(),a.children(".chart-no-data-label").show(),a=a.attr("id"),e.charts)e.charts[c].divId==a&&e.charts[c].sliderEnabled&&$("#"+a).find("#controlsMapTab").show()}function G(a){var c=
$(a.target).closest(".chart");if(0==c.children(".chart-add").size()){z(a);var c=$(a.target).closest(".chart").attr("id"),b;for(b in e.charts)e.charts[b].divId==c&&H($(a.target).closest(".chart"),!0,e.charts[b],chartConfig)}else y(a),c.children(".chart-add").detach()}var t=[],P=function(a,c,b){var d=ALA.ChartConstants.colors[(a+1)%(ALA.ChartConstants.colors.length-1)];if("pie"==c.chartType||"doughnut"==c.chartType)d=[],$.each(b,function(a,b){null==b.label&&(b.label="");c.hideEmptyValues&&""==b.label||
d.push(ALA.ChartConstants.colors[(a+1)%(ALA.ChartConstants.colors.length-1)])});return d},Q=function(a,c,b){var d=c.valueType&&c.valueFacet?c.valueType:"count",h={labels:[],datasets:[],maxValue:void 0,labelToFq:{}};$.each(a,function(g,f){var e=P(g,c,f.data);1==a.length&&"pie"!=c.chartType&&"doughnut"!=c.chartType&&(e="#97BBCD");h.datasets[g]={label:jQuery.i18n.prop(c.title),backgroundColor:r(e,50),data:[]};0<=$.inArray(c.chartType,["bar","horizontal-bar","horizontalBar"])&&(h.datasets[g].borderColor=
r(e,85),h.datasets[g].hoverBackgroundColor=r(e,100),h.datasets[g].hoverBorderColor=r(e,85),h.datasets[g].borderWidth=1);c.facet!=f.label&&(h.datasets[g].label=f.label);$.each(f.data,function(e,f){null==f.label&&(f.label="");if(!c.hideEmptyValues||""!=f.label){e=jQuery.i18n.prop(f.label);e.includes("[")&&(e=f.label);e=e.substring(0,80);""==f.label.trim()&&(e=c.emptyValueMsg?c.emptyValueMsg:"Not available");h.labels.length<a[0].data.length&&h.labels.push(e);h.datasets[g].data.push(f[d]);if(!h.maxValue||
h.maxValue<f[d])h.maxValue=f[d];h.labelToFq[e]=f.fq?f.fq:b+":"+f.label}})});return h},R=function(a,c,b){var d=b.valueType&&b.valueFacet?b.valueType:"count";$.each(c,function(c,e){var f=Array(a.labels.length);$.each(e.data,function(e,g){null==g.label&&(g.label="");if(!b.hideEmptyValues||""!=g.label){e=g.label.substring(0,80);""==g.label.trim()&&(e=b.emptyValueMsg?b.emptyValueMsg:"Not available");for(var n=0;n<a.labels.length;n++)a.labels[n]==e&&(f[n]=!0,a.datasets[c].data[n]=g[d],n=a.labels.length)}});
for(e=0;e<a.labels.length;e++)f[e]||(a.datasets[c].data[e]=0)});return a},p=function(a,c,b){var d=b?c.divId:S(a,c.title,c);c&&!c.hideOnce?(c.sliderEnabled?$("#"+d).find("#controlsMapTab").show():$("#"+d).find("#controlsMapTab").hide(),I(c,e.query,a,e.facetQueries,e.queryContext,c.filter,d,function(b){c.slider||u(c,c.sliderFacet,function(b){b={parent:$("#"+d),range:b,date:"tdate"==m(c.sliderFacet).dataType,callback:function(b){if("tdate"==m(c.sliderFacet).dataType){var d=(new Date(b[0])).toISOString();
b=(new Date(b[1])).toISOString();c.sliderFq="&fq="+encodeURIComponent(c.sliderFacet+":["+d+" TO "+b+"]")}else c.sliderFq="&fq="+c.sliderFacet+":["+b[0]+"%20TO%20"+b[1]+"]";p(a,c,!0)}};c.slider=new RegionTimeControls(b)});c.sliderFq?b=R(c.datastructure,b,c):(b=Q(b,c,a),c.maxValue=b.maxValue,c.datastructure=b);var e=b.labelToFq,f=$("#"+d).find("canvas");0<b.datasets[0].data.length?c.chart=T(b,e,f,c,d):(f.parent().append($("<label>No data to display</label>").addClass("chart-no-data-label")),f.parent().find(".chart-canvas").detach(),
f.parent().find(".chart-legend").detach())})):delete c.hideOnce},J=function(a,c,b,d,e){if("horizontalBar"==c||"bar"==c||"line"==c){if(b.trimLabels){var g;if("horizontalBar"==c)g=.45*d.chart.width;else if("bar"==c||"line"==c)g=.45*d.chart.height;g=g/d.options.defaultFontSize*2;for(var f=0;f<a.labels.length;f++)a.labels[f].length>g&&(a.labels[f]=a.labels[f].substring(0,g-3)+"...")}b.growToFit&&(b=d.data.labels.length*d.options.defaultFontSize*1.5,"horizontalBar"==c?$("#"+e).height()<b&&(d.options.maintainAspectRatio=
!1,$("#"+e).height(b),d.resize()):("bar"==c||"line"==c)&&$("#"+e).width()<b&&(d.options.maintainAspectRatio=!1,d.scales["x-axis-0"].options.ticks.autoSkip=!1,d.scales["x-axis-0"].options.ticks.stepSize=1,$("#"+e).width(b),d.resize()));d.data=a;d.update()}return 0},T=function(a,c,b,d,h){var g,f="horizontal-bar"==d.chartType?"horizontalBar":d.chartType;if(d.chart)J(a,f,d,d.chart,h),d.chart.data=a,d.chart.update(),g=d.chart;else{var A=b.get(0).getContext("2d"),k=U(f,d.maxValue,d.logarithmic);g=new Chart(A,
{type:f,data:a,options:{responsive:!0,scales:k,legend:{display:!1}}});if("pie"==f||"doughnut"==f||d.seriesEnabled)$("#"+h).find(".chart-legend").get(0).innerHTML=g.generateLegend();J(a,f,d,g,h);b.click(function(a){a=g.getElementsAtEvent(a);a=Object.keys(c)[a[0]._index];window.location.href=e.biocacheWebappUrl+"/occurrences/search?q="+e.query+"&fq="+c[a]})}return g},U=function(a,c,b){var d={};b?"bar"==a||"line"==a?d={yAxes:[{type:"logarithmic",ticks:{max:c}}]}:"horizontalBar"==a&&(d={xAxes:[{type:"logarithmic",
ticks:{max:c}}]}):"bar"==a||"line"==a?d={yAxes:[{ticks:{max:c}}]}:"horizontalBar"==a&&(d={xAxes:[{ticks:{max:c}}]});return d},I=function(a,c,b,d,h,g,f,A){if(""==c||void 0==c)c="*:*";a.sliderEnabled&&(c+="&fq="+encodeURIComponent(a.sliderFacet+":*"));d="";a.valueType&&0<a.valueType.length&&"count"!=a.valueType&&a.valueFacet&&(d="&stats="+a.valueFacet);var k=a.valueRanges&&0<a.valueRanges.length?"&xranges="+K(b,a.valueRanges):"",n=a.seriesRanges&&0<a.seriesRanges.length?"&seriesranges="+K(a.seriesFacet,
a.seriesRanges):"",m=a.seriesEnabled&&a.seriesFacet&&0<a.seriesFacet.length?"&series="+a.seriesFacet:"",l="";a.seriesEnabled&&a.seriesFq&&0<a.seriesFq.length&&(l="&fq=",$.each(a.seriesFq,function(a,b){4<l.length&&(l+="%20OR%20");l+="("+encodeURIComponent(b)+")"}));a.sliderFq||(a.sliderFq="");a=e.biocacheServiceUrl+"/chart.json?q="+c+(b?"&x="+b:"")+k+"&qc="+h+d+a.sliderFq+n+m+l+(a.includeOther?"&xother="+a.includeOther:"")+(a.includeOtherSeries?"&seriesother="+a.includeOtherSeries:"")+(a.hideEmptyValues?
"&xmissing="+!a.hideEmptyValues:"");g&&(a=a+"&"+g);f&&$("#"+f).find(".chart-loading").show();$.ajax({url:a,type:"GET",error:function(a,b,c){alert("error")},success:function(a){A(a.data)},error:function(a){A([])},complete:function(){f&&$("#"+f).find(".chart-loading").hide()}})},K=function(a,c){if("tdate"==m(a).dataType){var b=[];$.each(c.split(","),function(a,c){b.push((new Date(Date.parse(c))).toISOString())});return b.join(",")}return c},L=0,S=function(a,c,b){var d=a+"-chart-"+L,h=a+"-chart",g="";
a=!1;b&&b.divId&&0<$("#"+b.divId).size()?(d=b.divId,h=$("#"+d),h.empty(),g="checked",a=!0):(b.divId=d,L++,h=$("<div/>").addClass("chart").addClass(h).attr("id",d));b.large&&h.width("100%");c=$("<h3/>").addClass("chart-title").html(c);var f=$("<canvas/>").addClass("chart-canvas"),l=$("<div/>").addClass("chart-legend").addClass("ala-doughnut-legend"),k=$("<label>loading...</label>").addClass("chart-loading");if(e.chartControls){var n=$("<button>delete</button>").addClass("btn").addClass("btn-xs").addClass("btn-mini").addClass("btn-danger").click(N),
m=$("<button>edit</button>").addClass("btn").addClass("btn-xs").addClass("btn-mini").click(G),g=$('<input type="checkbox" name="show-hide-chart" class="bootToggle" '+g+">").change(O);h.append(c).append(n).append(m).append(g)}else h.append(c);h.append($('<ul class="nav nav-tabs" id="controlsMapTab">                <div id="timeControls" class="text-center">                     <div id="timeButtons">                        <span class="timeControl link" id="playButton" title="Play" alt="Play"></span>                        <span class="timeControl link" id="pauseButton" title="Pause play" alt="Pause play"></span>                        <span class="timeControl link" id="stopButton" title="Stop" alt="Stop"></span>                        <span class="timeControl link" id="resetButton" title="Reset" alt="Reset"></span>                        <input class="timeControl link" id="stepSize" title="Step size" alt="Step size">                    </div>                    <div id="timeSlider">                        <div id="timeRange"><span id="timeFrom"></span> - <span id="timeTo"></span></div>                    </div>                </div>            </ul>').hide());
b&&!b.hideOnce&&h.append(f).append(l).append(k);a||$("#"+w).append(h);h.find(".bootToggle").bootstrapToggle({on:"hide",off:"show",size:"mini",onstyle:"default"});return d},B=function(a,c,b,d){return $("<div/>").addClass("chart-add-group").append($("<label>"+jQuery.i18n.prop(a)+"</label>").addClass("chart-add-label").append(v(d))).append($("<input/>").addClass("chart-add-"+c).val(b))},l=function(a,c,b,d,e){var g=$("<select/>").addClass("chart-add-"+c);$(b).each(function(a,b){g.append($("<option/>").attr("value",
b).text(b))});g.val(d);return $("<div/>").addClass("chart-add-group").append($("<label>"+jQuery.i18n.prop(a)+"</label>").addClass("chart-add-label").append(v(e))).append(g)},q=function(a,c,b,d){return $("<div/>").addClass("chart-add-group").append($("<label>"+jQuery.i18n.prop(a)+"</label>").addClass("chart-add-label").append(v(d))).append($("<input/>").addClass("chart-add-"+c).attr("type","checkbox").prop("checked",b))},v=function(a){return $("<i/>").addClass("fa fa-question-circle hint").attr("title",
a)},H=function(a,c,b){var d=$("<div/>").addClass("chart-add"),e=B("Title","title",b&&b.title?b.title:"My chart","Text will appear above the chart"),g=l("Value","value-type","count sum max min mean missing stddev".split(" "),b&&b.valueType?b.valueType:"count",'Secondary axis "value", default is record count'),f=q("Series enabled","series-enabled",b&&b.seriesEnabled?b.seriesEnabled:!1,"Include additional data series on the chart."),k=q("Slider enabled","slider-enabled",b&&b.sliderEnabled?b.sliderEnabled:
!1,"Add a slider to change the 3rd axis (usually date)"),m=B("Series ranges","series-ranges",b&&b.seriesRanges?b.seriesRanges:"",'Enter comma delimited list to group selected series values. The list should begin with the min value and end with the max value. e.g. "0,0.2,1" will produce the groups "0 to 0.2", "0.2 to 1".'),n=B("Facet ranges","value-ranges",b&&b.valueRanges?b.valueRanges:"",'Enter comma delimited list to group selected facet values. The list should begin with the min value and end with the max value. e.g. "0,0.2,1" will produce the groups "0 to 0.2", "0.2 to 1".'),
p=l("Chart type","chart-type",["bar","horizontalBar","doughnut","pie","line"],b&&b.chartType?b.chartType:"bar","chart type is self explanatory"),r=B("Empty value message","empty-value-msg",b&&b.emptyValueMsg?b.emptyValueMsg:"Unknown","This text will appear when no value is present in the data"),u=q("Hide empty values","hide-empty-values",b&&void 0!==b.hideEmptyValues?b.hideEmptyValues:!0,"empty value will be removed from chart"),v=q('Include "Other".',"include-other",b&&b.includeOther?b.includeOther:
!1,'Charts have a limit on the number of facets that will be displayed. Including "Other" will group all the excluded facets together.'),w=q('Include "Other" for the series.',"include-other-series",b&&b.includeOtherSeries?b.includeOtherSeries:!1,'Charts have a limit on the number of series that will be displayed. Including "Other" will group all the excluded series together.'),x=q("Large chart","large",b&&b.large?b.large:!1,"Chart will take up the full width of the surrounding block"),y=q("Logarithmic",
"logarithmic",b&&b.logarithmic?b.logarithmic:!1,"Value axis will show logarithmic scale - use for large range of values in data"),C=l("Facet","facet",[],"","Choose a facet field for the first axis of the chart - see the filter column for facets that have values in your data"),D=l("Value facet","value-facet",[],"",'Choose a facet field for the secondary axis of the chart - values are computed using the "Value" type chosen'),E=l("Series facet","series-facet",[],"",'Choose a facet field for the "series" axis of the chart'),
F=l("Slider facet","slider-facet",[],"",'Choose a facet field for the "slider" axis of the chart');$(t).each(function(a,b){b.indexed&&(a=b.description?b.description:b.name,C.find("select").append($("<option/>").attr("value",b.name).text(a)),E.find("select").append($("<option/>").attr("value",b.name).text(a)),"int"!=b.dataType&&"double"!=b.dataType&&"long"!=b.dataType&&"tint"!=b.dataType&&"tdouble"!=b.dataType&&"tlong"!=b.dataType||D.find("select").append($("<option/>").attr("value",b.name).text(a)),
"int"!=b.dataType&&"double"!=b.dataType&&"tdate"!=b.dataType||F.find("select").append($("<option/>").attr("value",b.name).text(a)))});b&&b.facet&&C.find("select").val(b.facet);b&&b.valueFacet&&D.find("select").val(b.valueFacet);b&&b.seriesFacet&&E.find("select").val(b.seriesFacet);b&&b.sliderFacet&&F.find("select").val(b.sliderFacet);var z=l("Series facet","series-fq",[],"","Restrict which series values to include.");c=c?$("<div/>").append($("<button>Apply changes</button>").addClass("chart-add-button").addClass("btn").addClass("btn-xs").addClass("btn-mini").click(V)).append($("<button>Cancel</button>").addClass("chart-add-cancel").addClass("btn").addClass("btn-xs").addClass("btn-mini").click(G)):
$("<button>Add new chart</button>").addClass("chart-add-button").addClass("btn").click(W);d.append(e);d.append(p);d.append(x);d.append(C);d.append(n);d.append(g);d.append(D);d.append(c);d.append(u);d.append(r);d.append(v);d.append(y);d.append(k);d.append(F);d.append(f);d.append(E);d.append(m);d.append(z);d.append(w);d.append(c);a.append(d);X(d,b)},X=function(a,c){a.find(".chart-add-chart-type").change(function(b){b="pie"!=a.find(".chart-add-chart-type").val()&&"doughnut"!=a.find(".chart-add-chart-type").val();
k(a,"logarithmic slider-facet series-enabled series-facet series-ranges include-other-series".split(" "),b);b&&(a.find(".chart-add-slider-enabled").change(),a.find(".chart-add-value-type").change(),a.find(".chart-add-series-facet").change(),a.find(".chart-add-series-enabled").change())});a.find(".chart-add-chart-type").change();a.find(".chart-add-series-enabled").change(function(b){b=a.find(".chart-add-series-enabled").prop("checked");k(a,["series-facet","series-ranges","series-fq","include-other-series"],
b);b&&a.find(".chart-add-series-facet").change()});a.find(".chart-add-series-enabled").change();a.find(".chart-add-slider-enabled").change(function(b){k(a,["slider-facet"],a.find(".chart-add-slider-enabled").prop("checked"))});a.find(".chart-add-slider-enabled").change();a.find(".chart-add-hide-empty-values").change(function(b){k(a,["empty-value-msg"],!a.find(".chart-add-hide-empty-values").prop("checked"))});a.find(".chart-add-hide-empty-values").change();a.find(".chart-add-value-type").change(function(b){k(a,
["value-facet"],"count"!=a.find(".chart-add-value-type").val())});a.find(".chart-add-value-type").change();a.find(".chart-add-facet").change(function(b){b=0<=$.inArray(m(a.find(".chart-add-facet").val()).dataType,"long tlong int tint double tdouble date tdate".split(" "));k(a,["value-ranges"],b);b?u(c,a.find(".chart-add-facet").val(),function(b){if("tdate"==m(a.find(".chart-add-facet").val()).dataType){var c=(new Date(b[0])).toISOString().slice(0,10);b=(new Date(b[1])).toISOString().slice(0,10);c=
c+" to "+b;a.find(".chart-add-value-ranges").attr("placeholder",c);a.find(".chart-add-value-ranges").attr("title",c)}else a.find(".chart-add-value-ranges").attr("placeholder",b[0]+" to "+b[1]),a.find(".chart-add-value-ranges").attr("title",b[0]+" to "+b[1])}):a.find(".chart-add-value-ranges").val("")});a.find(".chart-add-facet").change();a.find(".chart-add-series-facet").change(function(b){a.find(".chart-add-series-enabled").prop("checked")?(b=0<=$.inArray(m(a.find(".chart-add-series-facet").val()).dataType,
"long tlong int tint double tdouble date tdate".split(" ")),k(a,["series-ranges"],b),k(a,["series-fq","include-other-series"],!b),b?(a.find(".chart-add-series-fq").multiselect("destroy").empty(),a.find(".chart-add-series-fq").val(""),u(c,a.find(".chart-add-series-facet").val(),function(b){if("tdate"==m(a.find(".chart-add-series-facet").val()).dataType){var c=(new Date(b[0])).toISOString().slice(0,10);b=(new Date(b[1])).toISOString().slice(0,10);c=c+" to "+b;a.find(".chart-add-series-ranges").attr("placeholder",
c);a.find(".chart-add-series-ranges").attr("title",c)}else a.find(".chart-add-series-ranges").attr("placeholder",b[0]+" to "+b[1]),a.find(".chart-add-series-ranges").attr("title",b[0]+" to "+b[1])})):(a.find(".chart-add-series-ranges").val(""),Y(e.query,e.facetQueries,e.queryContext,c.filter,a.find(".chart-add-series-facet").val(),function(b){var e=a.find(".chart-add-series-fq").multiselect("destroy");e.empty();e.attr("multiple",!0);$.each(b,function(a,b){0<b.count&&b.label&&0<b.label.length&&(a=
$("<option/>").attr("value",b.fq).text(b.label),0<=$.inArray(b.fq,c.seriesFq)&&a.attr("selected",!0),e.append(a))});e.multiselect({maxHeight:300,numberDisplayed:1})}))):k(a,["series-ranges","series-fq","include-other-series"],!1)});a.find(".chart-add-series-facet").change()},Y=function(a,c,b,d,h,g){a=e.biocacheServiceUrl+"/occurrences/search.json?q="+a+"&qc="+b+"&pageSize=0&flimit=100&facet=true&facets="+h;d&&(a=a+"&"+d);$.ajax({url:a,type:"GET",error:function(a,b,c){alert("error")},success:function(a){g(a.facetResults[0].fieldResult)},
error:function(a){g([])}})},k=function(a,c,b){$.each(c,function(c,e){c=a.find(".chart-add-"+e).closest(".chart-add-group");b?c.show():c.hide()})},m=function(a){for(var c in t)if(t[c].name==a)return t[c];return{}},W=function(a){a=M($(a.target).closest(".chart-add"));p(a.facet,a);for(var c=0;void 0!==e.charts[c+"*"+a.facet];)c++;e.charts[c+"*"+a.facet]=a;e.chartControlsCallback&&e.chartControlsCallback(e)},V=function(a){a=$(a.target).closest(".chart").attr("id");var c=$("#"+a),b;for(b in e.charts)if(e.charts[b].divId==
a){var d=M(c);d.divId=a;e.charts[b]=d;e.chartControlsCallback&&e.chartControlsCallback(e);p(d.facet,d)}},M=function(a){return{title:a.find(".chart-add-title").val(),large:a.find(".chart-add-large").prop("checked"),facet:a.find(".chart-add-facet").val(),valueFacet:a.find(".chart-add-value-facet").val(),valueType:a.find(".chart-add-value-type").val(),chartType:a.find(".chart-add-chart-type").val(),emptyValueMsg:a.find(".chart-add-empty-value-msg").val(),hideEmptyValues:a.find(".chart-add-hide-empty-values").prop("checked"),
seriesEnabled:a.find(".chart-add-series-enabled").prop("checked"),sliderEnabled:a.find(".chart-add-slider-enabled").prop("checked"),valueRanges:a.find(".chart-add-value-ranges").val(),seriesFacet:a.find(".chart-add-series-facet").val(),seriesRanges:a.find(".chart-add-series-ranges").val(),sliderFacet:a.find(".chart-add-slider-facet").val(),logarithmic:a.find(".chart-add-logarithmic").prop("checked"),seriesFq:a.find(".chart-add-series-fq").val(),includeOtherSeries:a.find(".chart-add-include-other-series").prop("checked"),
includeOther:a.find(".chart-add-include-other").prop("checked")}},u=function(a,c,b,d){c?(a=jQuery.extend(!0,{},a),a.valueType="max",a.valueFacet=c,a.facet=null,a.seriesEnabled=!1,a.sliderFq="",a.valueRanges=[],I(a,e.query,a.facet,e.facetQueries,e.queryContext,a.filter,a.divId,function(a){0<a.length&&0<a[0].data.length?b([a[0].data[0].min,a[0].data[0].max]):d&&d()})):d&&d()},Z=function(a){$(a.target).parent().children(".chart-add:first").toggle()};$.ajax({url:e.biocacheServiceUrl+"/index/fields.json",
type:"GET",error:function(a,c,b){console.log("unable to get index/fields")},success:function(a){t=a.sort(function(a,b){a=(a.description?a.description:a.name).toLowerCase();b=(b.description?b.description:b.name).toLowerCase();return a<b?-1:a>b?1:0});e.chartControls&&(a=$("<div/>").append($("<button>Toggle Chart Controls</button>").addClass("chart-controls-toggle").addClass("btn").click(Z)),$("#"+w).prepend(a),H(a,!1,{},{}),a.children(".chart-add:first").toggle())}});$.each(e.charts,function(a,c){void 0===
c.facet?p(a,c):p(c.facet,c)});$("body").tooltip({selector:".hint"})}};