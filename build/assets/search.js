//# sourceMappingURL=search.js.map
(function(a){"function"===typeof define&&define.amd?define(a):window.purl=a()})(function(){function a(a,f){a=decodeURI(a);f=t[f?"strict":"loose"].exec(a);a={attr:{},param:{},seg:{}};for(var m=14;m--;)a.attr[c[m]]=f[m]||"";a.param.query=g(a.attr.query);a.param.fragment=g(a.attr.fragment);a.seg.path=a.attr.path.replace(/^\/+|\/+$/g,"").split("/");a.seg.fragment=a.attr.fragment.replace(/^\/+|\/+$/g,"").split("/");a.attr.base=a.attr.host?(a.attr.protocol?a.attr.protocol+"://"+a.attr.host:a.attr.host)+
(a.attr.port?":"+a.attr.port:""):"";return a}function l(a){a=a.tagName;return"undefined"!==typeof a?b[a.toLowerCase()]:a}function k(a,f,m,b){var d=a.shift();if(d){var c=f[m]=f[m]||[];if("]"==d)if(h(c))""!==b&&c.push(b);else if("object"==typeof c){f=a=c;m=[];for(var g in f)f.hasOwnProperty(g)&&m.push(g);a[m.length]=b}else f[m]=[f[m],b];else{~d.indexOf("]")&&(d=d.substr(0,d.length-1));if(!r.test(d)&&h(c))if(0===f[m].length)c=f[m]={};else{g={};for(var e in f[m])g[e]=f[m][e];c=f[m]=g}k(a,c,d,b)}}else h(f[m])?
f[m].push(b):f[m]="object"==typeof f[m]?b:"undefined"==typeof f[m]?b:[f[m],b]}function g(a){return e(String(a).split(/&|;/),function(a,b){try{b=decodeURIComponent(b.replace(/\+/g," "))}catch(d){}var c=b.indexOf("="),g;a:{for(var e=b.length,l,q=0;q<e;++q)if(l=b[q],"]"==l&&(g=!1),"["==l&&(g=!0),"="==l&&!g){g=q;break a}g=void 0}e=b.substr(0,g||c);c=b.substr(g||c,b.length);c=c.substr(c.indexOf("=")+1,c.length);""===e&&(e=b,c="");b=e;if(~b.indexOf("]")){var n=b.split("[");k(n,a,"base",c)}else{if(!r.test(b)&&
h(a.base)){e={};for(n in a.base)e[n]=a.base[n];a.base=e}""!==b&&(n=a.base,e=n[b],"undefined"===typeof e?n[b]=c:h(e)?e.push(c):n[b]=[e,c])}return a},{base:{}}).base}function e(a,b,d){for(var c=0,e=a.length>>0;c<e;)c in a&&(d=b.call(void 0,d,a[c],c,a)),++c;return d}function h(a){return"[object Array]"===Object.prototype.toString.call(a)}function d(b,f){1===arguments.length&&!0===b&&(f=!0,b=void 0);b=b||window.location.toString();return{data:a(b,f||!1),attr:function(a){a=q[a]||a;return"undefined"!==
typeof a?this.data.attr[a]:this.data.attr},param:function(a){return"undefined"!==typeof a?this.data.param.query[a]:this.data.param.query},fparam:function(a){return"undefined"!==typeof a?this.data.param.fragment[a]:this.data.param.fragment},segment:function(a){if("undefined"===typeof a)return this.data.seg.path;a=0>a?this.data.seg.path.length+a:a-1;return this.data.seg.path[a]},fsegment:function(a){if("undefined"===typeof a)return this.data.seg.fragment;a=0>a?this.data.seg.fragment.length+a:a-1;return this.data.seg.fragment[a]}}}
var b={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href",embed:"src",object:"data"},c="source protocol authority userInfo user password host port relative path directory file query fragment".split(" "),q={anchor:"fragment"},t={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},
r=/^[0-9]+$/;d.jQuery=function(a){null!=a&&(a.fn.url=function(b){var c="";this.length&&(c=a(this).attr(l(this[0]))||"");return d(c,b)},a.url=d)};d.jQuery(window.jQuery);return d});void 0===jQuery.migrateMute&&(jQuery.migrateMute=!0);
(function(a,l,k){function g(b){var f=l.console;h[b]||(h[b]=!0,a.migrateWarnings.push(b),f&&f.warn&&!a.migrateMute&&(f.warn("JQMIGRATE: "+b),a.migrateTrace&&f.trace&&f.trace()))}function e(b,f,d,c){if(Object.defineProperty)try{return Object.defineProperty(b,f,{configurable:!0,enumerable:!0,get:function(){return g(c),d},set:function(a){g(c);d=a}}),k}catch(m){}a._definePropertyBroken=!0;b[f]=d}var h={};a.migrateWarnings=[];!a.migrateMute&&l.console&&l.console.log&&l.console.log("JQMIGRATE: Logging is active");
a.migrateTrace===k&&(a.migrateTrace=!0);a.migrateReset=function(){h={};a.migrateWarnings.length=0};"BackCompat"===document.compatMode&&g("jQuery is not compatible with Quirks Mode");var d=a("<input/>",{size:1}).attr("size")&&a.attrFn,b=a.attr,c=a.attrHooks.value&&a.attrHooks.value.get||function(){return null},q=a.attrHooks.value&&a.attrHooks.value.set||function(){return k},t=/^(?:input|button)$/i,r=/^[238]$/,n=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,
f=/^(?:checked|selected)$/i;e(a,"attrFn",d||{},"jQuery.attrFn is deprecated");a.attr=function(c,m,e,h){var l=m.toLowerCase(),q=c&&c.nodeType;return h&&(4>b.length&&g("jQuery.fn.attr( props, pass ) is deprecated"),c&&!r.test(q)&&(d?m in d:a.isFunction(a.fn[m])))?a(c)[m](e):("type"===m&&e!==k&&t.test(c.nodeName)&&c.parentNode&&g("Can't change the 'type' of an input or button in IE 6/7/8"),!a.attrHooks[l]&&n.test(l)&&(a.attrHooks[l]={get:function(b,f){var d,c=a.prop(b,f);return!0===c||"boolean"!=typeof c&&
(d=b.getAttributeNode(f))&&!1!==d.nodeValue?f.toLowerCase():k},set:function(b,f,d){var c;return!1===f?a.removeAttr(b,d):(c=a.propFix[d]||d,c in b&&(b[c]=!0),b.setAttribute(d,d.toLowerCase())),d}},f.test(l)&&g("jQuery.fn.attr('"+l+"') may use property instead of attribute")),b.call(a,c,m,e))};a.attrHooks.value={get:function(a,b){var f=(a.nodeName||"").toLowerCase();return"button"===f?c.apply(this,arguments):("input"!==f&&"option"!==f&&g("jQuery.fn.attr('value') no longer gets properties"),b in a?a.value:
null)},set:function(a,b){var f=(a.nodeName||"").toLowerCase();return"button"===f?q.apply(this,arguments):("input"!==f&&"option"!==f&&g("jQuery.fn.attr('value', val) no longer sets properties"),a.value=b,k)}};var m,p,u=a.fn.init,y=a.parseJSON,z=/^([^<]*)(<[\w\W]+>)([^>]*)$/;a.fn.init=function(b,f,d){var c;return b&&"string"==typeof b&&!a.isPlainObject(f)&&(c=z.exec(a.trim(b)))&&c[0]&&("<"!==b.charAt(0)&&g("$(html) HTML strings must start with '<' character"),c[3]&&g("$(html) HTML text after last tag is ignored"),
"#"===c[0].charAt(0)&&(g("HTML string cannot start with a '#' character"),a.error("JQMIGRATE: Invalid selector string (XSS)")),f&&f.context&&(f=f.context),a.parseHTML)?u.call(this,a.parseHTML(c[2],f,!0),f,d):u.apply(this,arguments)};a.fn.init.prototype=a.fn;a.parseJSON=function(a){return a||null===a?y.apply(this,arguments):(g("jQuery.parseJSON requires a valid JSON string"),null)};a.uaMatch=function(a){a=a.toLowerCase();a=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||
/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||[];return{browser:a[1]||"",version:a[2]||"0"}};a.browser||(m=a.uaMatch(navigator.userAgent),p={},m.browser&&(p[m.browser]=!0,p.version=m.version),p.chrome?p.webkit=!0:p.webkit&&(p.safari=!0),a.browser=p);e(a,"browser",a.browser,"jQuery.browser is deprecated");a.sub=function(){function b(a,f){return new b.fn.init(a,f)}a.extend(!0,b,this);b.superclass=this;b.fn=b.prototype=this();b.fn.constructor=b;b.sub=
this.sub;b.fn.init=function(d,c){return c&&c instanceof a&&!(c instanceof b)&&(c=b(c)),a.fn.init.call(this,d,c,f)};b.fn.init.prototype=b.fn;var f=b(document);return g("jQuery.sub() is deprecated"),b};a.ajaxSetup({converters:{"text json":a.parseJSON}});var x=a.fn.data;a.fn.data=function(b){var f,d,c=this[0];return!c||"events"!==b||1!==arguments.length||(f=a.data(c,b),d=a._data(c,b),f!==k&&f!==d||d===k)?x.apply(this,arguments):(g("Use of jQuery.fn.data('events') is deprecated"),d)};var J=/\/(java|ecma)script/i,
I=a.fn.andSelf||a.fn.addBack;a.fn.andSelf=function(){return g("jQuery.fn.andSelf() replaced by jQuery.fn.addBack()"),I.apply(this,arguments)};a.clean||(a.clean=function(b,f,d,c){f=f||document;f=!f.nodeType&&f[0]||f;f=f.ownerDocument||f;g("jQuery.clean() is deprecated");var m,e,h=[];if(a.merge(h,a.buildFragment(b,f).childNodes),d)for(m=function(a){return!a.type||J.test(a.type)?c?c.push(a.parentNode?a.parentNode.removeChild(a):a):d.appendChild(a):k},b=0;null!=(f=h[b]);b++)a.nodeName(f,"script")&&m(f)||
(d.appendChild(f),f.getElementsByTagName!==k&&(e=a.grep(a.merge([],f.getElementsByTagName("script")),m),h.splice.apply(h,[b+1,0].concat(e)),b+=e.length));return h});var A=a.event.add,C=a.event.remove,S=a.event.trigger,D=a.fn.toggle,E=a.fn.live,F=a.fn.die,L=/\b(?:ajaxStart|ajaxStop|ajaxSend|ajaxComplete|ajaxError|ajaxSuccess)\b/,Z=/(?:^|\s)hover(\.\S+|)\b/,G=function(b){return"string"!=typeof b||a.event.special.hover?b:(Z.test(b)&&g("'hover' pseudo-event is deprecated, use 'mouseenter mouseleave'"),
b&&b.replace(Z,"mouseenter$1 mouseleave$1"))};a.event.props&&"attrChange"!==a.event.props[0]&&a.event.props.unshift("attrChange","attrName","relatedNode","srcElement");a.event.dispatch&&e(a.event,"handle",a.event.dispatch,"jQuery.event.handle is undocumented and deprecated");a.event.add=function(a,b,f,d,c){a!==document&&L.test(b)&&g("AJAX events should be attached to document: "+b);A.call(this,a,G(b||""),f,d,c)};a.event.remove=function(a,b,f,d,c){C.call(this,a,G(b)||"",f,d,c)};a.fn.error=function(){var a=
Array.prototype.slice.call(arguments,0);return g("jQuery.fn.error() is deprecated"),a.splice(0,0,"error"),arguments.length?this.bind.apply(this,a):(this.triggerHandler.apply(this,a),this)};a.fn.toggle=function(b,f){if(!a.isFunction(b)||!a.isFunction(f))return D.apply(this,arguments);g("jQuery.fn.toggle(handler, handler...) is deprecated");var d=arguments,c=b.guid||a.guid++,m=0,e=function(f){var c=(a._data(this,"lastToggle"+b.guid)||0)%m;return a._data(this,"lastToggle"+b.guid,c+1),f.preventDefault(),
d[c].apply(this,arguments)||!1};for(e.guid=c;d.length>m;)d[m++].guid=c;return this.click(e)};a.fn.live=function(b,f,d){return g("jQuery.fn.live() is deprecated"),E?E.apply(this,arguments):(a(this.context).on(b,this.selector,f,d),this)};a.fn.die=function(b,f){return g("jQuery.fn.die() is deprecated"),F?F.apply(this,arguments):(a(this.context).off(b,this.selector||"**",f),this)};a.event.trigger=function(a,b,f,d){return f||L.test(a)||g("Global events are undocumented and deprecated"),S.call(this,a,b,
f||document,d)};a.each("ajaxStart ajaxStop ajaxSend ajaxComplete ajaxError ajaxSuccess".split(" "),function(b,f){a.event.special[f]={setup:function(){var b=this;return b!==document&&(a.event.add(document,f+"."+a.guid,function(){a.event.trigger(f,null,b,!0)}),a._data(this,f,a.guid++)),!1},teardown:function(){return this!==document&&a.event.remove(document,f+"."+a._data(this,f)),!1}}})})(jQuery,window);
(function(a){function l(d,b){a.ajax({url:d,async:!1,cache:b.cache,contentType:"text/plain;charset="+b.encoding,dataType:"text",success:function(a){k(a,b.mode)}})}function k(d,b){var c="";d=d.split(/\n/);for(var h=/(\{\d+\})/g,k=/\{(\d+)\}/g,l=/(\\u.{4})/ig,n=0;n<d.length;n++)if(d[n]=d[n].replace(/^\s\s*/,"").replace(/\s\s*$/,""),0<d[n].length&&"#"!=d[n].match("^#")){var f=d[n].split("=");if(0<f.length){for(var m=unescape(f[0]).replace(/^\s\s*/,"").replace(/\s\s*$/,""),p=1==f.length?"":f[1];"\\"==
p.match(/\\$/);)p=p.substring(0,p.length-1),p+=d[++n].replace(/\s\s*$/,"");for(var u=2;u<f.length;u++)p+="="+f[u];p=p.replace(/^\s\s*/,"").replace(/\s\s*$/,"");if("map"==b||"both"==b){if(f=p.match(l))for(u=0;u<f.length;u++)p=p.replace(f[u],e(f[u]));a.i18n.map[m]=p}if("vars"==b||"both"==b)if(p=p.replace(/"/g,'\\"'),g(m),h.test(p)){for(var f=p.split(h),u=!0,y="",z=[],x=0;x<f.length;x++)!h.test(f[x])||0!=z.length&&-1!=z.indexOf(f[x])||(u||(y+=","),y+=f[x].replace(k,"v$1"),z.push(f[x]),u=!1);c+=m+"=function("+
y+"){";m='"'+p.replace(k,'"+v$1+"')+'"';c+="return "+m+";};"}else c+=m+'="'+p+'";'}}eval(c)}function g(a){if(/\./.test(a)){var b="";a=a.split(/\./);for(var c=0;c<a.length;c++)0<c&&(b+="."),b+=a[c],eval("typeof "+b+' == "undefined"')&&eval(b+"={};")}}function e(a){var b=[];a=parseInt(a.substr(2),16);0<=a&&a<Math.pow(2,16)&&b.push(a);a="";for(var c=0;c<b.length;++c)a+=String.fromCharCode(b[c]);return a}a.i18n={};a.i18n.map={};a.i18n.properties=function(d){d=a.extend({name:"Messages",language:"",path:"",
mode:"vars",cache:!1,encoding:"UTF-8",callback:null},d);if(null===d.language||""==d.language)d.language=a.i18n.browserLang();null===d.language&&(d.language="");var b=d.name&&d.name.constructor==Array?d.name:[d.name];for(i=0;i<b.length;i++)l(d.path+b[i]+".properties",d),2<=d.language.length&&l(d.path+b[i]+"_"+d.language.substring(0,2)+".properties",d),5<=d.language.length&&l(d.path+b[i]+"_"+d.language.substring(0,5)+".properties",d);d.callback&&d.callback()};a.i18n.prop=function(d){var b=a.i18n.map[d];
if(null==b)return"["+d+"]";var c;if("string"==typeof b){for(c=0;-1!=(c=b.indexOf("\\",c));)b="t"==b[c+1]?b.substring(0,c)+"\t"+b.substring(c++ +2):"r"==b[c+1]?b.substring(0,c)+"\r"+b.substring(c++ +2):"n"==b[c+1]?b.substring(0,c)+"\n"+b.substring(c++ +2):"f"==b[c+1]?b.substring(0,c)+"\f"+b.substring(c++ +2):"\\"==b[c+1]?b.substring(0,c)+"\\"+b.substring(c++ +2):b.substring(0,c)+b.substring(c+1);var e=[],h,g;for(c=0;c<b.length;)if("'"==b[c])if(c==b.length-1)b=b.substring(0,c);else if("'"==b[c+1])b=
b.substring(0,c)+b.substring(++c);else{for(h=c+2;-1!=(h=b.indexOf("'",h));)if(h==b.length-1||"'"!=b[h+1]){b=b.substring(0,c)+b.substring(c+1,h)+b.substring(h+1);c=h-1;break}else b=b.substring(0,h)+b.substring(++h);-1==h&&(b=b.substring(0,c)+b.substring(c+1))}else if("{"==b[c])if(h=b.indexOf("}",c+1),-1==h)c++;else if(g=parseInt(b.substring(c+1,h)),!isNaN(g)&&0<=g){var k=b.substring(0,c);""!=k&&e.push(k);e.push(g);c=0;b=b.substring(h+1)}else c=h+1;else c++;""!=b&&e.push(b);b=e;a.i18n.map[d]=e}if(0==
b.length)return"";if(1==b.lengh&&"string"==typeof b[0])return b[0];k="";for(c=0;c<b.length;c++)k+="string"==typeof b[c]?b[c]:b[c]+1<arguments.length?arguments[b[c]+1]:"{"+b[c]+"}";return k};a.i18n.browserLang=function(){var a=navigator.language||navigator.userLanguage,a=a.toLowerCase();3<a.length&&(a=a.substring(0,3)+a.substring(3).toUpperCase());return a};var h;h||(h=function(a,b,c){if("[object RegExp]"!==Object.prototype.toString.call(b))return"undefined"==typeof h._nativeSplit?a.split(b,c):h._nativeSplit.call(a,
b,c);var e=[],g=0,k=(b.ignoreCase?"i":"")+(b.multiline?"m":"")+(b.sticky?"y":"");b=RegExp(b.source,k+"g");var l,f,m;a+="";h._compliantExecNpcg||(l=RegExp("^"+b.source+"$(?!\\s)",k));if(void 0===c||0>+c)c=Infinity;else if(c=Math.floor(+c),!c)return[];for(;f=b.exec(a);){k=f.index+f[0].length;if(k>g&&(e.push(a.slice(g,f.index)),!h._compliantExecNpcg&&1<f.length&&f[0].replace(l,function(){for(var a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(f[a]=void 0)}),1<f.length&&f.index<a.length&&Array.prototype.push.apply(e,
f.slice(1)),m=f[0].length,g=k,e.length>=c))break;b.lastIndex===f.index&&b.lastIndex++}g===a.length?(m||!b.test(""))&&e.push(""):e.push(a.slice(g));return e.length>c?e.slice(0,c):e},h._compliantExecNpcg=void 0===/()??/.exec("")[1],h._nativeSplit=String.prototype.split);String.prototype.split=function(a,b){return h(this,a,b)}})(jQuery);
(function(a){"function"===typeof define&&define.amd?define(["jquery"],a):a(jQuery)})(function(a){function l(a){a=e.json?JSON.stringify(a):String(a);return e.raw?a:encodeURIComponent(a)}function k(h,d){var b;if(e.raw)b=h;else a:{0===h.indexOf('"')&&(h=h.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{h=decodeURIComponent(h.replace(g," "));b=e.json?JSON.parse(h):h;break a}catch(c){}b=void 0}return a.isFunction(d)?d(b):b}var g=/\+/g,e=a.cookie=function(h,d,b){if(void 0!==d&&!a.isFunction(d)){b=
a.extend({},e.defaults,b);if("number"===typeof b.expires){var c=b.expires,g=b.expires=new Date;g.setTime(+g+864E5*c)}return document.cookie=[e.raw?h:encodeURIComponent(h),"=",l(d),b.expires?"; expires="+b.expires.toUTCString():"",b.path?"; path="+b.path:"",b.domain?"; domain="+b.domain:"",b.secure?"; secure":""].join("")}b=h?void 0:{};for(var c=document.cookie?document.cookie.split("; "):[],g=0,t=c.length;g<t;g++){var r=c[g].split("="),n;n=r.shift();n=e.raw?n:decodeURIComponent(n);r=r.join("=");if(h&&
h===n){b=k(r,d);break}h||void 0===(r=k(r))||(b[n]=r)}return b};e.defaults={};a.removeCookie=function(e,d){if(void 0===a.cookie(e))return!1;a.cookie(e,"",a.extend({},d,{expires:-1}));return!a.cookie(e)}});
(function(a){function l(){var c,e={height:d.innerHeight,width:d.innerWidth};e.height||!(c=h.compatMode)&&a.support.boxModel||(c="CSS1Compat"===c?b:h.body,e={height:c.clientHeight,width:c.clientWidth});return e}var k={},g,e,h=document,d=window,b=h.documentElement,c=a.expando;a.event.special.inview={add:function(b){k[b.guid+"-"+this[c]]={data:b,$element:a(this)}},remove:function(a){try{delete k[a.guid+"-"+this[c]]}catch(b){}}};a(d).bind("scroll resize",function(){g=e=null});setInterval(function(){var c=
a(),t,r=0;a.each(k,function(a,b){a=b.data.selector;b=b.$element;c=c.add(a?b.find(a):b)});if(t=c.length)for(g=g||l(),e=e||{top:d.pageYOffset||b.scrollTop||h.body.scrollTop,left:d.pageXOffset||b.scrollLeft||h.body.scrollLeft};r<t;r++)if(a.contains(b,c[r])){var n=a(c[r]),f={height:n.height(),width:n.width()},m=n.offset(),p=n.data("inview"),u;if(!e||!g)break;m.top+f.height>e.top&&m.top<e.top+g.height&&m.left+f.width>e.left&&m.left<e.left+g.width?(u=e.left>m.left?"right":e.left+g.width<m.left+f.width?
"left":"both",f=e.top>m.top?"bottom":e.top+g.height<m.top+f.height?"top":"both",m=u+"-"+f,(!p||p!==m)&&n.data("inview",m).trigger("inview",[!0,u,f])):p&&n.data("inview",!1).trigger("inview",[!1])}},250)})(jQuery);
(function(a){function l(){}function k(a){D=[a]}function g(a,b,f){return a&&a.apply&&a.apply(b.context||b,f)}function e(e){function G(a){M++||(N(),K&&(C[w]={s:[a]}),V&&(a=V.apply(e,[a])),g(Q,e,[a,z,e]),g(U,e,[e,z]))}function P(a){M++||(N(),K&&a!=x&&(C[w]=a),g(R,e,[e,a]),g(U,e,[e,a]))}e=a.extend({},E,e);var Q=e.success,R=e.error,U=e.complete,V=e.dataFilter,W=e.callbackParameter,X=e.callback,ca=e.cache,K=e.pageCache,Y=e.charset,w=e.url,B=e.data,aa=e.timeout,O,M=0,N=l,ba,v,H,T;return I&&I(function(a){a.done(Q).fail(R);
Q=a.resolve;R=a.reject}).promise(e),e.abort=function(){!M++&&N()},!1===g(e.beforeSend,e,[e])||M?e:(w=w||b,B=B?"string"==typeof B?B:a.param(B,e.traditional):b,w+=B?(/\?/.test(w)?"&":"?")+B:b,W&&(w+=(/\?/.test(w)?"&":"?")+encodeURIComponent(W)+"=?"),!ca&&!K&&(w+=(/\?/.test(w)?"&":"?")+"_"+(new Date).getTime()+"="),w=w.replace(/=\?(&|$)/,"="+X+"$1"),K&&(O=C[w])?O.s?G(O.s[0]):P(O):(J[X]=k,v=a(y)[0],v.id=t+S++,Y&&(v[d]=Y),F&&11.6>F.version()?(H=a(y)[0]).text="document.getElementById('"+v.id+"')."+n+"()":
v[h]=h,L&&(v.htmlFor=v.id,v.event=r),v[f]=v[n]=v[m]=function(a){if(!v[p]||!/i/.test(v[p])){try{v[r]&&v[r]()}catch(b){}a=D;D=0;a?G(a[0]):P(c)}},v.src=w,N=function(a){T&&clearTimeout(T);v[m]=v[f]=v[n]=null;A[u](v);H&&A[u](H)},A[q](v,ba=A.firstChild),H&&A[q](H,ba),T=0<aa&&setTimeout(function(){P(x)},aa)),e)}var h="async",d="charset",b="",c="error",q="insertBefore",t="_jqjsp",r="onclick",n="on"+c,f="onload",m="onreadystatechange",p="readyState",u="removeChild",y="<script>",z="success",x="timeout",J=window,
I=a.Deferred,A=a("head")[0]||document.documentElement,C={},S=0,D,E={callback:t,url:location.href},F=J.opera,L=!!a("<div>").html("\x3c!--[if IE]><i><![endif]--\x3e").find("i").length;e.setup=function(b){a.extend(E,b)};a.jsonp=e})(jQuery);
$(document).ready(function(){function a(){var a=$(window).height(),a=.8*a;$("#viewerContainerId").height(a)}jQuery.i18n.properties({name:"messages",path:BC_CONF.contextPath+"/messages/i18n/",mode:"map",language:BC_CONF.locale});$("select#sort").change(function(){var a=$("option:selected",this).val();reloadWithParam("sort",a)});$("select#dir").change(function(){var a=$("option:selected",this).val();reloadWithParam("dir",a)});$("select#sort").change(function(){var a=$("option:selected",this).val();
reloadWithParam("sort",a)});$("select#dir").change(function(){var a=$("option:selected",this).val();reloadWithParam("dir",a)});$("select#per-page").change(function(){var a=$("option:selected",this).val();reloadWithParam("pageSize",a)});var l=!1,k=!1,g=!1,e=!1,h=!1;$('a[data-toggle="tab"]').on("shown.bs.tab",function(a){var b=$(this).attr("id");a=a.currentTarget.hash.substring(1);amplify.store("search-tab-state",a);location.hash="tab_"+a;"t2"!=b||l?"t3"!=b||k?"t6"!=b||g?"t4"!=b||h?"t5"==b&&!e&&BC_CONF.hasMultimedia&&
(loadImagesInTab(),e=!0):(loadSpeciesInTab(0,"common"),h=!0):(loadUserCharts(),g=!0):(loadDefaultCharts(),k=!0):(initialiseMap(),l=!0)});var d=amplify.store("search-tab-state");d||!BC_CONF.defaultListView||window.location.hash||(window.location.hash=BC_CONF.defaultListView);""!==location.hash?$('.nav-tabs a[href="'+location.hash.replace("tab_","")+'"]').tab("show"):d?$('.nav-tabs a[href="#'+d+'"]').tab("show"):$(".nav-tabs a:first").tab("show");var b=[];$("li.species_guid, li.genus_guid").each(function(a,
c){b[a]=$(c).attr("id")});0<b.length&&(d=b.slice(0,15),d=BC_CONF.bieWebappUrl+"/species/namesFromGuids.json?guid="+d.join("&guid=")+"&callback=?",$.getJSON(d,function(a){$("li.species_guid, li.genus_guid").each(function(b,c){if(15>b)$(c).find("a").html("<i>"+a[b]+"</i>");else return!1})}),15<b.length&&(d=b.slice(15),d=BC_CONF.bieWebappUrl+"/species/namesFromGuids.json?guid="+d.join("&guid=")+"&callback=?",$.getJSON(d,function(a){$("li.species_guid, li.genus_guid").each(function(b,c){14<b&&(b-=15,
$(c).find("a").html("<i>"+a[b]+"</i>"))})})));(d=$("b.species_guid").attr("id"))&&$.getJSON(BC_CONF.bieWebappUrl+"/species/namesFromGuids.json?guid="+d+"&callback=?",function(a){$("b.species_guid").html("<i>"+a[0]+"</i>")});(d=$.url().param("q"))&&"*:*"==d[0]&&$(":input#solrQuery").val("");$(".activeFilter").click(function(a){a.preventDefault();removeFilter(this)});$("#facetCheckboxes").children().not("#updateFacetOptions").click(function(a){a.stopPropagation()});$("#toggleFacetDisplay").click(function(){$(this).find("i").toggleClass("icon-chevron-down icon-chevron-right");
$(".sidebar").is(":visible")?$(".sidebar").removeClass("overrideHide"):$(".sidebar").addClass("overrideHide")});$("input.facetOpts").change(function(){var a=0;$("#facetConfigErrors").html("").hide();$("input.facetOpts:checkbox:checked").each(function(){a++});BC_CONF.maxFacets&&0<BC_CONF.maxFacets&&a>BC_CONF.maxFacets&&$("#facetConfigErrors").html(jQuery.i18n.prop("facets.max.exceeded",a-BC_CONF.maxFacets)).show()});$("#updateFacetOptions").click(function(a){a.preventDefault();var b=[];$(":input.facetOpts:checked").each(function(a,
f){b.push($(f).val())});0<b.length&&b.length<=BC_CONF.maxFacets?($.cookie("user_facets",b,{expires:7}),document.location.reload(!0)):b.length>BC_CONF.maxFacets?alert(jQuery.i18n.prop("facets.max.exceeded",b.length-BC_CONF.maxFacets)):alert(jQuery.i18n.prop("facets.max.select1"))});$("#resetFacetOptions").click(function(a){a.preventDefault();$.removeCookie("user_facets");document.location.reload(!0)});if(d=$.cookie("user_facets"))for(i in $(":input.facetOpts").removeAttr("checked"),d=d.split(","),
d)"string"===typeof d[i]&&$(":input.facetOpts[value='"+d[i]+"']").attr("checked","checked");$(".selectNone").click(function(a){a.preventDefault();$(":input.facetOpts").removeAttr("checked")});$(".selectAll").click(function(a){a.preventDefault();$(":input.facetOpts").attr("checked","checked")});$("span.lsid").not(".searchError .lsid").each(function(a,b){var c=$(this).attr("id"),d=$(this).html(),e=BC_CONF.biocacheServiceUrl+"/occurrences/search.json?q=lsid:"+c+"&"+BC_CONF.facetQueries+"&facets=raw_taxon_name&pageSize=0&flimit=20"+
(BC_CONF.queryContext?"&qc="+BC_CONF.queryContext:"")+"&callback=?",g=$("#resultsReturned #template").clone();g.attr("id","");g.find(".taxaMenuContent").addClass("stopProp");g.find("form.raw_taxon_search").attr("id","rawTaxonSearch_"+a);g.find(":input.rawTaxonSumbit").attr("id","rawTaxonSumbit_"+a);g.find(".refineTaxaSearch").attr("id","refineTaxaSearch_"+a);$.getJSON(e,function(b){var e=BC_CONF.bieWebappUrl+"/species/"+c,m="<a href='"+e+"' title='Species page' target='BIE'>view species page</a>";
g.find("a.btn").text(d).attr("href",e);g.find(".nameString").text(d);g.find(".speciesPageLink").html(m);var h=0,k="";$.each(b.facetResults,function(b,c){"raw_taxon_name"==c.fieldName&&$.each(c.fieldResult,function(b,c){h++;k+="<input type='checkbox' name='raw_taxon_guid' id='rawTaxon_"+a+"_"+b+"' class='rawTaxonCheckBox' value='"+c.label+"'/>&nbsp;<a href='"+BC_CONF.contextPath+"/occurrences/search?q=raw_taxon_name:%22"+c.label+"%22'>"+c.label+"</a> ("+c.count+")<br/>"})});0==h&&(k+="[no records found]");
20<=h&&(k+='<div><br>Only showing the first 20 names<br>See the "Scientific name (unprocessed)" section in the "Refine results" column on the left for a complete list</div>');g.find("div.rawTaxaList").html(k);g.removeClass("hide");g.find(".stopProp").children().not("input.rawTaxonSumbit").click(function(a){a.stopPropagation()})});$(b).html(g)});$(":input.rawTaxonSumbit").on("click",function(a){a.preventDefault();a=$(this).attr("id").replace("rawTaxonSumbit_","");var b=!1;$("#refineTaxaSearch_"+a).find(":input.rawTaxonCheckBox").each(function(a,
f){if($(f).is(":checked"))return b=!0,!1});b?$(this.form).submit():alert('Please check at least one "verbatim scientific name" checkbox.')});$("#loadMoreImages .btn").live("click",function(a){a.preventDefault();$(this).addClass("disabled");$(this).find("img").show();a=$("#imagesGrid").data("count");loadImages(a)});$("#loadMoreSpecies").live("click",function(a){a.preventDefault();a=$("#speciesGallery").data("count");var b=$("#speciesGroup :selected").val(),c=$("#speciesGallery").data("sort");loadSpeciesInTab(a,
c,b)});$("#speciesGroup, #speciesGallerySort").live("change",function(a){a=$("#speciesGroup :selected").val();var b=$("#speciesGallerySort :selected").val();loadSpeciesInTab(0,b,a)});$(".recordRow").click(function(a){a.preventDefault();window.location.href=BC_CONF.contextPath+"/occurrences/"+$(this).attr("id")}).hover(function(){$(this).css("cursor","pointer");$(this).css("background-color","#FFF")},function(){$(this).css("cursor","default");$(this).css("background-color","transparent")});$(".multipleFacetsLink").click(function(){var a=
this.id.replace("multi-","").replace("_guid","").replace("_uid","_name").replace("data_resource_name","data_resource_uid").replace("data_provider_name","data_provider_uid").replace("species_list_name","species_list_uid").replace("occurrence_year","decade"),b=$(this).data("displayname");loadMoreFacets(a,b,null)});$("#multipleFacets").on("hidden",function(){$("tbody.scrollContent tr").not("#spinnerRow").remove()});$("#downloadFacet").live("click",function(a){a=$("table#fullFacets").data("facet");window.location.href=
BC_CONF.biocacheServiceUrl+"/occurrences/facets/download"+BC_CONF.facetDownloadQuery+"&facets="+a+"&count=true&lookup=true"});$("#submitFacets :input.submit").live("click",function(a){a.preventDefault();a="exclude"==$(this).attr("id")?"-":"";var b="";$("table#fullFacets").data("facet");var c=!1,d=0;$("form#facetRefineForm").find(":input.fqs").each(function(a,f){$(f).is(":checked")&&(c=!0,d++,b+=$(f).val()+" OR ")});b=b.replace(/ OR $/,"");-1!=b.indexOf(" OR ")&&(b="("+b+")");c&&15<d?alert("Too many options selected - maximum is 15, you have selected "+
d+", please de-select "+(d-15)+" options. \n\nNote: if you want to include/exclude all possible values (wildcard filter), use the drop-down option on the buttons below."):c?window.location.href=window.location.pathname+BC_CONF.searchString+("&fq="+a+b)+window.location.hash:alert("Please select at least one checkbox.")});$("#submitFacets a.wildcard").live("click",function(a){a.preventDefault();a=-1!=$(this).attr("id").indexOf("exclude")?"-":"";var b=$("table#fullFacets").data("facet");window.location.href=
window.location.pathname+BC_CONF.searchString+("&fq="+a+b+":*")});$("a.multipleFacetsLink, a#downloadLink, a#alertsLink, .tooltips, .tooltip, span.dropDown a, div#customiseFacets > a, a.removeLink, .btn, .rawTaxonSumbit").qtip({style:{classes:"ui-tooltip-rounded ui-tooltip-shadow"},position:{target:"mouse",adjust:{x:6,y:14}}});$("a.fsort").live("click",function(a){a.preventDefault();a=$(this).data("sort");var b=$(this).data("foffset"),c=$(this).closest("table");0==c.length&&(c=$(this).parent().siblings("table#fullFacets"));
var d=$(c).data("facet");$(c).data("label");loadFacetsContent(d,a,b,BC_CONF.facetLimit,!0)});$("a.loadMoreValues").live("click",function(a){a.preventDefault();var b=$(this);a=b.data("sort");var b=b.data("foffset"),c=$("table#fullFacets"),d=$(c).data("facet");$(c).data("label");loadFacetsContent(d,a,b,BC_CONF.facetLimit,!1)});$("tr#loadMore").live("inview",function(){var a=$(this).find("a.loadMoreValues"),b=a.data("sort"),a=a.data("foffset"),c=$("table#fullFacets"),d=$(c).data("facet");$(c).data("label");
loadFacetsContent(d,b,a,BC_CONF.facetLimit,!1)});var c=BC_CONF.alertsUrl||"https://alerts.ala.org.au";$("a#alertNewRecords, a#alertNewAnnotations").click(function(a){a.preventDefault();a=$("<p>"+BC_CONF.queryString+"</p>").text();var b=decodeURIComponent(BC_CONF.facetQueries).split("&fq=").filter(function(a){return 0===a||a});b&&(b=b.join("; "),0<b.length&&(a+=" ("+b+")"));b=$(this).data("method");b=c+"/ws/"+b+"?";b+="queryDisplayName="+encodeURIComponent(a);b+="&baseUrlForWS="+encodeURIComponent(BC_CONF.biocacheServiceUrl.replace(/\/ws$/,
""));b+="&baseUrlForUI="+encodeURIComponent(BC_CONF.serverName);b+="&webserviceQuery=%2Fws%2Foccurrences%2Fsearch"+BC_CONF.searchString;b=b+"&uiQuery=%2Foccurrences%2Fsearch%3Fq%3D*%3A*"+("&resourceName="+encodeURIComponent(BC_CONF.resourceName));window.location.href=b});$(".showHideFacetGroup").click(function(a){a.preventDefault();var b=$(this).data("name");$(this).find("span").toggleClass("right-caret");$("#group_"+b).slideToggle(600,function(){$("#group_"+b).is(":visible")?($("#group_"+b).find(".nano").nanoScroller({preventPageScrolling:!0}),
amplify.store("search-facets-state-"+b,!0)):amplify.store("search-facets-state-"+b,null)})});$(".facetsGroup").each(function(a,b){a=$(b).attr("id").replace(/^group_/,"");var c=amplify.store("search-facets-state-"+a);""==$.trim($(b).html())?$("#heading_"+a).hide():c&&$(b).prev().find("a").click()});$(".nano").nanoScroller({preventPageScrolling:!0,sliderMinHeight:90});amplify.store("lastSearch",$.url().attr("relative"));$("#recordImages").on("hover",".imgCon",function(){$(this).find(".brief, .detail").toggleClass("hide")});
var q,t,r,n;$(document).delegate(".thumbImage","click",function(b){var c='<a href="RECORD_URL">View details of this record</a>';b.preventDefault();q=$(this).attr("data-image-id");n=$(this).attr("data-scientific-name");t=$(this).find(".meta.detail").html();r=$(this).attr("href");c=c.replace("RECORD_URL",r);b='<a href="RECORD_URL">record.</a>'.replace("RECORD_URL",r);t+="<br>"+c+"<br><br>If this image is incorrectly<br>identified please flag an<br>issue on the "+b+"<br>";a();$("#imageDialog").modal("show")});
$("#imageDialog").on("shown.bs.modal",function(){0==$("#viewerContainerId").width()&&$("#viewerContainerId").width($("#imageDialog").width()-50);imgvwr.viewImage($("#viewerContainerId"),q,n,void 0,{imageServiceBaseUrl:BC_CONF.imageServiceBaseUrl,addSubImageToggle:!1,addCalibration:!1,addDrawer:!1,addCloseButton:!0,addAttribution:!0,addLikeDislikeButton:BC_CONF.addLikeDislikeButton,addPreferenceButton:BC_CONF.addPreferenceButton,attribution:t,disableLikeDislikeButton:BC_CONF.disableLikeDislikeButton,
likeUrl:BC_CONF.likeUrl+"?id="+q,dislikeUrl:BC_CONF.dislikeUrl+"?id="+q,userRatingUrl:BC_CONF.userRatingUrl+"?id="+q,userRatingHelpText:BC_CONF.userRatingHelpText.replace("RECORD_URL",r),savePreferredSpeciesListUrl:BC_CONF.savePreferredSpeciesListUrl+"?id="+q+"&scientificName="+n,getPreferredSpeciesListUrl:BC_CONF.getPreferredSpeciesListUrl})});$(window).on("resize",a)});
function reloadWithParam(a,l){var k=[],g=$.url().param("q"),e=$.url().param("fq"),h=$.url().param("sort"),d=$.url().param("dir"),b=$.url().param("wkt"),c=$.url().param("pageSize"),q=$.url().param("lat"),t=$.url().param("lon"),r=$.url().param("radius"),n=$.url().param("taxa");null!=g&&k.push("q="+g);e&&"string"===typeof e?e=[e]:e||(e=[]);e&&k.push("fq="+e.join("&fq="));"sort"!=a&&null!=h&&k.push("sort="+h);"dir"!=a&&null!=d&&k.push("dir="+d);"pageSize"!=a&&null!=c&&k.push("pageSize="+c);null!=a&&null!=
l&&k.push(a+"="+l);q&&t&&r&&(k.push("lat="+q),k.push("lon="+t),k.push("radius="+r));n&&k.push("taxa="+n);b&&k.push("wkt="+b);window.location.href=window.location.pathname+"?"+k.join("&")}
function removeFacet(a){a=$(a).data("facet").replace(/\+/g," ");var l=$.url().param("q"),k=$.url().param("fq"),g=$.url().param("lat"),e=$.url().param("lon"),h=$.url().param("radius"),d=$.url().param("taxa"),b=[];null!=l&&b.push("q="+l);k&&"string"===typeof k&&(k=[k]);g&&e&&h&&(b.push("lat="+g),b.push("lon="+e),b.push("radius="+h));d&&b.push("taxa="+d);if(k instanceof Array)for(var c in k)-1!=decodeURIComponent(k[c].replace(/\+/g," ")).indexOf(decodeURIComponent(a))&&k.splice($.inArray(k[c],k),1);
else decodeURIComponent(k)==a&&(k=null);null!=k&&b.push("fq="+k.join("&fq="));window.location.href=window.location.pathname+"?"+b.join("&")+window.location.hash+""}
function removeFilter(a){a=$(a).data("facet").replace(/^\-/g,"");var l=$.url().param("q"),k=$.url().param("fq"),g=$.url().param("lat"),e=$.url().param("lon"),h=$.url().param("radius"),d=$.url().param("taxa"),b=$.url().param("wkt"),c=[];null!=l&&c.push("q="+l);k&&"string"===typeof k&&(k=[k]);g&&e&&h&&(c.push("lat="+g),c.push("lon="+e),c.push("radius="+h));b&&c.push("wkt="+b);d&&c.push("taxa="+d);for(var q in k)-1!=k[q].split(":")[0].replace(/[\(\)\-]/g,"").indexOf(a)&&k.splice($.inArray(k[q],k),1);
"all"==a&&(k=[]);null!=k&&c.push("fq="+k.join("&fq="));window.location.href=window.location.pathname+"?"+c.join("&")+window.location.hash+""}
function loadDefaultCharts(){dynamicFacets&&0<dynamicFacets.length?$.getJSON(BC_CONF.biocacheServiceUrl+"/upload/charts/"+BC_CONF.selectedDataResource+".json",function(a){var l={};$.each(a,function(a,g){g.visible&&(a="bar","pie"==g.format&&(a="doughnut"),l[g.field]={chartType:a,emptyValueMsg:"",hideEmptyValues:!0,title:g.field})});chartConfig.charts=l;ALA.BiocacheCharts("charts",chartConfig)}):ALA.BiocacheCharts("charts",chartConfig)}
function loadUserCharts(){userChartConfig&&$.ajax({dataType:"json",url:BC_CONF.serverName+"/user/chart",success:function(a){3<$.map(a,function(a,k){return k}).length?($.map(a.charts,function(a,k){a.hideOnce=!0}),a.chartControlsCallback=saveChartConfig,a.biocacheServiceUrl=userChartConfig.biocacheServiceUrl,a.biocacheWebappUrl=userChartConfig.biocacheWebappUrl,a.query=userChartConfig.query,a.queryContext=userChartConfig.queryContext,a.filter=userChartConfig.filter,a.facetQueries=userChartConfig.facetQueries,
ALA.BiocacheCharts("userCharts",a)):(userChartConfig.charts={},userChartConfig.chartControlsCallback=saveChartConfig,ALA.BiocacheCharts("userCharts",userChartConfig))},error:function(a){userChartConfig.charts={};userChartConfig.chartControlsCallback=saveChartConfig;ALA.BiocacheCharts("userCharts",userChartConfig)}})}
function saveChartConfig(a){var l=jQuery.extend(!0,{},a);delete l.chartControlsCallback;$.each(l.charts,function(a,g){g.slider&&delete g.slider});$.each(l.charts,function(a,g){g.datastructure&&delete g.datastructure});$.each(l.charts,function(a,g){g.chart&&delete g.chart});a&&$.ajax({url:BC_CONF.serverName+"/user/chart",type:"POST",dataType:"json",contentType:"application/json",data:JSON.stringify(l)})}function loadImagesInTab(){loadImages(0)}
function loadImages(a){a=a?a:0;$.getJSON(BC_CONF.biocacheServiceUrl+"/occurrences/search.json"+BC_CONF.searchString+"&fq=multimedia:Image&facet=false&pageSize=20&start="+a+"&sort=identification_qualifier_s&dir=asc&callback=?",function(l){if(l.occurrences&&0<l.occurrences.length){0==a&&$("#imagesGrid").html("");var k=0;$.each(l.occurrences,function(a,e){k++;var h=void 0===e.raw_scientificName?e.scientificName:e.raw_scientificName;a=$(".imgConTmpl").clone();a.removeClass("imgConTmpl").removeClass("hide");
var d=a.find("a.cbLink");d.addClass("thumbImage tooltips");d.attr("href",BC_CONF.contextPath+"/occurrences/"+e.uuid);d.attr("title","click to enlarge");d.attr("data-occurrenceuid",e.uuid);d.attr("data-image-id",e.image);d.attr("data-scientific-name",h);a.find("img").attr("src",e.smallImageUrl);d=h;e.typeStatus&&(d+="<br>"+e.typeStatus);e.institutionName&&(d+=(e.typeStatus?" | ":"<br>")+e.institutionName);a.find(".brief").html(d);e.typeStatus&&(h+="<br>Type: "+e.typeStatus);e.collector&&(h+="<br>By: "+
e.collector);e.eventDate&&(h+="<br>Date: "+moment(e.eventDate).format("YYYY-MM-DD"));h=e.institutionName?h+("<br>"+e.institutionName):h+("<br>"+e.dataResourceName);a.find(".detail").html(h);$("#imagesGrid").append(a.html())});k+a<l.totalRecords?($("#imagesGrid").data("count",k+a),$("#loadMoreImages").show(),$("#loadMoreImages .btn").removeClass("disabled")):$("#loadMoreImages").hide()}else $("#imagesGrid").html("<p>"+jQuery.i18n.prop("list.noimages.available")+"</p>")}).always(function(){$("#loadMoreImages img").hide()})}
function loadSpeciesInTab(a,l,k){var g=$("#speciesGallery").data("init");a=a?a:0;k=k?k:"ALL_SPECIES";switch(l){case "taxa":l="&common=false&sort=index";break;default:case "common":l="&common=true&sort=index";break;case "count":l="&common=false&sort=count"}g||($.getJSON(BC_CONF.biocacheServiceUrl+"/explore/groups.json"+BC_CONF.searchString+"&facets=species_group&callback=?",function(a){0<a.length&&($("#speciesGroup").empty(),$.each(a,function(a,d){if(0<d.count){a=Array(d.level+1).join("-")+" ";var b=
d.name.replace("_"," ");0==d.level&&(b=b.toLowerCase(),b=b.charAt(0).toUpperCase()+b.slice(1));d=$("<option value='"+d.name+"'>"+a+b+" ("+d.speciesCount+")</option>");$("#speciesGroup").append(d)}}))}).error(function(){$("#speciesGroup option").val("Error: species groups were not loaded")}),$("#speciesGallery").data("init",!0));0==a?($("#speciesGallery").empty().before("<div id='loadingSpecies'>Loading... <img src='"+BC_CONF.contextPath+"/images/spinner.gif'/></div>"),$("#loadMoreSpecies").hide()):
$("#loadMoreSpecies img").show();$.getJSON(BC_CONF.contextPath+"/proxy/exploreGroupWithGallery"+BC_CONF.searchString+"&group="+k+"&pageSize=20&start="+a+l,function(e){if(0<e.length){var g=0;$.each(e,function(a,b){g++;6E3<b.rankId&&b.thumbnailUrl&&(a=$("<img src='"+b.thumbnailUrl+"' style='height:100px; cursor:pointer;'/>"),a.data({type:"species",guid:b.guid,rank:b.rank,rankId:b.rankId,sciName:b.scientificName,commonName:b.commonName,count:b.count}),$("#speciesGallery").append(a))});20==g?($("#speciesGallery").data("count",
g+a),$("#loadMoreSpecies").show()):$("#loadMoreSpecies").hide();$("#speciesGallery img").ibox()}}).error(function(a,g,d){alert(a.responseText)}).complete(function(){$("#loadingSpecies").remove();$("#loadMoreSpecies img").hide()})}
(function(a){a.fn.ibox=function(){resize=50;this.parent().parent().parent().append('<div id="ibox" />');a("body").append('<div id="ibox" />');var l=a("#ibox"),k=0,g=0;this.each(function(){var e=a(this);e.mouseenter(function(){l.html("");var h=e.height(),d=e.width(),h=(d/h*(h+resize)-d)/2+6;k=e.position().left-h;g=e.position().top-6;var h=e.height(),d=e.width(),b;checkwh=h<d?b=d/h*resize/2:b=d*resize/h/2;a(this).clone().prependTo(l);var c,q,t=a(e).data();"species"==t.type?(c=BC_CONF.bieWebappUrl+"/species/"+
t.guid,d="Go to ALA species page",h=" ",q=" <br/>Record count: "+t.count):(c=BC_CONF.contextPath+"/occurrences/"+t.uuid,d="Go to occurrence record",h="<span style='text-transform: capitalize'>"+t.rank+"</span>: ",q="");h="<div style=''><a href='"+c+"' title='"+d+"'>"+h+(6E3<=t.rankId?"<span style='font-style: italic;'>":"<span>")+t.sciName+"</span><br/>"+t.commonName.replace("| ","")+"</a> "+q+"</div>";a(l).append(h);a(l).click(function(a){a.preventDefault();window.location.href=c});l.css({top:g+
"px",left:k+"px","max-width":a(e).width()+2*b+12});l.stop().fadeTo(200,1,function(){a(this).children("img").animate({height:"+="+resize},200)})});l.mouseleave(function(){l.html("").hide()})})}})(jQuery);var hoverDropDownDiv=!1;
function loadMoreFacets(a,l,k,g){g=g?g:"0";var e=BC_CONF.facetLimit,h=BC_CONF.searchString.replace(/^\?/,"").split("&"),d="";$.each(h,function(a,c){a=c.split("=");2==a.length&&(d+="<input type='hidden' name='"+a[0]+"' value='"+a[1]+"'/>")});$("#facetRefineForm").append(d);$("table#fullFacets").data("facet",a);$("table#fullFacets").data("label",l);$("#indexCol a").html(l);$("#indexCol a").attr("title","sort by "+l);$("table#fullFacets tbody").html("");$("a.fsort").qtip({style:{classes:"ui-tooltip-rounded ui-tooltip-shadow"},
position:{target:"mouse",adjust:{x:8,y:12}}});loadFacetsContent(a,k,g,e)}
function loadFacetsContent(a,l,k,g,e){var h=BC_CONF.biocacheServiceUrl+"/occurrences/search.json"+BC_CONF.searchString+"&facets="+a+"&flimit="+g+"&foffset="+k+"&pageSize=0";l&&(h+="&fsort="+l);$.getJSON(h+"&callback=?",function(d){if(d.totalRecords&&0<d.totalRecords){var b=!1,c="";$("tr#loadingRow").remove();$("tr#loadMore").remove();e&&$("table#fullFacets tr").not("tr.tableHead").not("#spinnerRow").remove();$.each(d.facetResults[0].fieldResult,function(d,e){if(0<e.count){var h=-1==e.label.indexOf(" ")&&
-1==e.label.indexOf(",")&&-1==e.label.indexOf("lsid")||0==e.label.indexOf("[")?e.label:'"'+e.label+'"',f=e.displayLabel?e.displayLabel:e.label;if(-1!=f.indexOf("@"))f=f.substring(0,f.indexOf("@"));else if(-1==jQuery.i18n.prop(e.i18nCode).indexOf("["))f=jQuery.i18n.prop(e.i18nCode);else if(-1!=a.indexOf("outlier_layer")||/^el\d+/.test(f))f=jQuery.i18n.prop("layer."+f);else if(-1!=a.indexOf("geospatial_kosher")||/^el\d+/.test(f))f=jQuery.i18n.prop("geospatial_kosher."+f);else if(-1!=a.indexOf("user_assertions")||
/^el\d+/.test(f))f=jQuery.i18n.prop("user_assertions."+f);else if(-1!=a.indexOf("duplicate_type")||/^el\d+/.test(f))f=jQuery.i18n.prop("duplication."+f);else if(-1!=a.indexOf("taxonomic_issue")||/^el\d+/.test(f))f=jQuery.i18n.prop(f);else if(f||-1==e.i18nCode.indexOf("novalue"))var k=jQuery.i18n.prop(a+"."+f),k=-1==k.indexOf("[")?k:jQuery.i18n.prop(f),f=-1==k.indexOf("[")?k:f;else f="[no value]";a=a.replace(/_RNG$/,"");h=e.fq?encodeURIComponent(e.fq):a+":"+encodeURIComponent(h);c+="<tr class='"+(0==
d%2?"normalRow":"alternateRow")+"'><td><input type='checkbox' name='fqs' class='fqs' value='"+h+"'/></td><td class='multiple-facet-value'><a href=\""+(BC_CONF.searchString+"&fq="+h)+'"> '+f+"</a></td><td class='multiple-facet-count'>"+e.count+"</td></tr>"}d==g-1&&(b=!0)});$("table#fullFacets tbody").append(c);$("#spinnerRow").hide();$("table#fullFacets tr:last td").css("border-bottom","1px solid #CCCCCC");$("table#fullFacets td:last-child, table#fullFacets th:last-child").css("border-right","none");
b&&(d="<tr id='loadMore' class=''><td colspan='3'><a href='#index' class='loadMoreValues' data-sort='"+l+"' data-foffset='"+(Number(k)+Number(g))+"'>Loading "+g+" more values...</a></td></tr>",$("table#fullFacets tbody").append(d));$("#fullFacets tbody").height();var h=0;$("#fullFacets tbody tr").each(function(a,b){h+=$(b).height()})}else $("tr#loadingRow").remove(),$("tr#loadMore").remove(),$("#spinnerRow").hide(),$("table#fullFacets tbody").append("<tr><td></td><td>[Error: no values returned]</td></tr>")})}
;